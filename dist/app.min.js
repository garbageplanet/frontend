var api={server:"https://garbagepla.net:8443/api",createUser:{method:"POST",url:function(){return api.server+"/register"}},createLogin:{method:"POST",url:function(){return api.server+"/authenticate"}},readUser:{method:"GET",url:function(){return api.createLogin.url()+"/user"}},removeUser:{method:"DELETE",url:function(){return api.createLogin.url()+"/delete"}},logoutUser:{method:"GET",url:function(){return api.createLogin.url()+"/logout"}},createSoftAccount:{method:"POST",url:function(){return api.server+"/glome/create"}},readSoftAccount:{method:"GET",url:function(id){return api.server+"/glome/show/"+id}},createTrash:{method:"POST",url:function(id){return api.readTrash.url()}},readTrash:{method:"GET",url:function(){return api.server+"/trashes"}},showTrash:{method:"GET",url:function(id){return api.readTrash.url()+"/"+id}},editTrash:{method:"PUT",url:function(){return api.readTrash.url()}},deleteTrash:{method:"DELETE",url:function(id){return api.readTrash.url()+"/"+id}},confirmTrash:{url:function(id){return api.readTrash.url()+"/confirm/"+id}},readTrashWithinBounds:{method:"GET",url:function(bounds){return api.readTrash.url()+"/withinbounds?bounds="+bounds}},createCleaning:{method:"POST",url:function(id){return api.readCleaning.url()}},readCleaning:{method:"GET",url:function(){return api.server+"/cleanings"}},showCleaning:{method:"GET",url:function(id){return api.readCleaning.url()+"/"+id}},editCleaning:{method:"PUT",url:function(id){return api.readCleaning.url()+"/"+id}},deleteCleaning:{method:"DELETE",url:function(id){return api.readCleaning.url()+"/"+id}},readCleaningWithinBounds:{method:"GET",url:function(bounds){return api.readCleaning.url()+"/withinbounds?bounds="+bounds}},attendCleaning:{url:function(id){return api.readCleaning.url()+"/attend/"+id}},readLitterWithinBounds:{method:"GET",url:function(bounds){return api.readLitter.url()+"/withinbounds?bounds="+bounds}},createLitter:{method:"POST",url:function(){return api.readLitter.url()}},readLitter:{method:"GET",url:function(){return api.server+"/litters"}},showLitter:{method:"GET",url:function(id){return api.readLitter.url()+"/"+id}},deleteLitter:{method:"DELETE",url:function(id){return api.readLitter.url()+"/"+id}},confirmLitter:{url:function(id){return api.readLitter.url()+"/confirm/"+id}},readAreaWithinBounds:{method:"GET",url:function(bounds){return api.readArea.url()+"/withinbounds?bounds="+bounds}},createArea:{method:"POST",url:function(){return api.readArea.url()}},readArea:{method:"GET",url:function(){return api.server+"/areas"}},showArea:{method:"GET",url:function(id){return api.readArea.url()+"/"+id}},deleteArea:{method:"DELETE",url:function(id){return api.readArea.url()+"/"+id}}};
(function($){"use strict";var tmpl=function(id,data){var f=tmpl.cache[id];return data?f(data,tmpl):function(data){return f(data,tmpl)}};tmpl.cache={"tmpl-credits":function(o,tmpl){var _e=tmpl.encode,_s="\n";for(var i=0;i<o.length;i++){_s+="\n"+_e(o[i].text)+' <a href="'+_e(o[i].linkurl)+'">'+_e(o[i].title)+"</a><br>\n"}_s+="\n";return _s},"tmpl-feature-info":function(o,tmpl){var _e=tmpl.encode,_s='\n<div class="row row-horizon bottombar-content" id="feature-info">\n<div class="card card-actions col-xl-1 col-lg-1 col-md-1 col-ms-1 col-sm-2 col-xs-2">\n<div>\n<div class="btn-group-vertical" role="group">\n<div class="btn-group btn-group-lg" role="group">\n<button type="button" title="Edit this feature" class="btn btn-warning btn-edit btn-round sidebar-link">\n<span class="fa fa-pencil"></span>\n</button>\n</div>\n<div class="btn-group btn-group-lg hidden-xs" role="group">\n<button type="button" title="Delete this feature" class="btn btn-danger btn-round btn-delete">\n<span class="fa fa-times"></span>\n</button>\n</div>\n';if(o.amount){_s+='\n<div class="btn-group btn-group-lg" role="group">\n<button type="button" title="The garbage has been cleaned" class="btn btn-round btn-success btn-cleaned">\n<span class="fa fa-check"></span>\n</button>\n</div>\n'}_s+="\n";if(o.amount){_s+='\n<div class="btn-group btn-group-lg" role="group">\n<button type="button" title="Confirm there is garbage here" class="btn btn-round btn-info btn-confirm-garbage">\n<span class="fa fa-binoculars"></span>\n</button>\n<span class="badge badge-notify badge-notify-confirm">'+_e(o.confirms)+"</span>\n</div>\n"}_s+="\n";if(o.datetime){_s+='\n<div class="btn-group btn-group-lg" role="group">\n<button type="button" title="Say you will help" class="btn btn-round btn-info btn-attend-cleaning">\n<span class="fa fa-group"></span>\n</button><span class="badge badge-notify badge-notify-attend">'+_e(o.attends)+"</span>\n</div>\n"}_s+="\n";if(o.contact){_s+='\n<div class="btn-group btn-group-lg" role="group">\n<button type="button" title="Join game" class="btn btn-round btn-info btn-participate-game">\n<span class="fa fa-play"></span>\n</button><span class="badge badge-notify badge-notify-participate">'+_e(o.participant)+"</span>\n</div>\n"}_s+='\n<div class="btn-group btn-group-lg" role="group">\n<button type="button" title="Share this" class="btn btn-round btn-default btn-social" data-toggle="popover" data-placement="top" data-trigger="focus">\n<span class="fa fa-share-alt"></span>\n</button>\n</div>\n</div>\n<div class="hidden" id="social-links"></div>\n</div>\n</div>\n<div class="card card-scroll card-data col-xl-2 col-lg-2 col-md-3 col-ms-3 col-sm-4 col-xs-6">\n<div><h3>Data</h3></div>\n<div class="feature-data-card">\n';if(o.types){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">type:'+_e(o.types)+'</span>\n<span class="feature-info feature-info-garbage feature-info-litter feature-info-garbage-type pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.amount){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">amount:'+_e(o.amount)+'</span>\n<span class="feature-info feature-info-garbage feature-info-litter feature-info-garbage-amount pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.size){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">sizes:'+_e(o.size)+'</span>\n<span class="feature-info feature-info-garbage feature-info-litter feature-info-garbage-size pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.embed){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">in:'+_e(o.embed)+'</span>\n<span class="feature-info feature-info-garbage feature-info-litter feature-info-garbage-embed pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.physical_length){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">length:'+_e(o.physical_length)+'</span>\n<span class="feature-info feature-info-garbage feature-info-litter feature-info-litter-length pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.todo){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">todo:'+_e(o.todo)+'</span>\n<span class="feature-info-garbage feature-info feature-info-todo pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.note){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">note:'+_e(o.note)+'</span>\n<span class="feature-info feature-info-common feature-info-note pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.tags){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">note:'+_e(o.tags)+'</span>\n<span class="feature-info feature-info-common feature-info-tags pull-left">\n';for(var i=0;i<o.tags.length;i++){_s+='\n<span class="label label-default">'+_e(o.tags[i])+"</span>\n"}_s+="\n</span>\n</div>\n</div>\n"}_s+="\n";if(o.datetime){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">time:'+_e(o.datetime)+'</span>\n<span class="feature-info feature-info-cleaning feature-info-time pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.datetime){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">location:</span>\n<span class="feature-info feature-info-cleaning feature-info-location pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.title){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">name:'+_e(o.title)+'</span>\n<span class="feature-info feature-info-area feature-info-name pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.contact){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">contact:'+_e(o.contact)+'</span>\n<span class="feature-info feature-info-area feature-info-contact pull-left"></span>\n</div>\n</div>\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">players:'+_e(o.players)+'</span>\n<span class="feature-info feature-info-area feature-info-players pull-left"></span>\n</div>\n</div>\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">results:<a href="'+_e(o.results_link)+'" class="game-results-modal-link" data-toggle="modal" data-target="#game-results-modal"> click here to view<a/></span>\n<span class="feature-info feature-info-area feature-info-results pull-left"></span>\n</div>\n</div>\n'}_s+="\n</div>\n</div>\n";if(o.image_url){_s+='\n<div class="card card-scroll card-media col-xl-2 col-lg-2 col-md-3 col-ms-3 col-sm-4 col-xs-6">\n<div><h3>Media</h3></div>\n<a class="feature-image-link" href="'+(o.image_url==null?"":o.image_url)+'" target="_blank"><img src="'+(o.image_url==null?"":o.image_url)+'" alt="feature image" class="feature-image center-block"></a>\n</div>\n'}_s+='\n<div class="card card-scroll card-track col-xl-2 col-lg-2 col-md-3 col-ms-3 col-sm-4 col-xs-6">\n<div><h3>Track changes</h3></div>\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">creation date:'+_e(o.created_at)+'</span>\n<span class="feature-info feature-info-created-at pull-left"></span>\n</div>\n</div>\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">created by:'+_e(o.created_by)+'</span>\n<span class="feature-info feature-info-created-by pull-left"></span>\n</div>\n</div>\n';if(o.modifided_by){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">modified by:'+_e(o.modifided_by)+'</span>\n<span class="feature-info feature-info-modified-by pull-left"></span>\n</div>\n</div>\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">modified at:'+_e(o.modifided_at)+'</span>\n<span class="feature-info feature-info-modified-at pull-left"></span>\n</div>\n</div>\n'}_s+="\n";if(o.cleaned_by){_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left">modified by:'+_e(o.cleaned_by)+'</span>\n<span class="feature-info feature-info-cleaned-by pull-left"></span>\n</div>\n</div>\n'}_s+='\n<div class="panel panel-default">\n<div class="panel-body">\n<span class="pull-left"><a class="feature-info-report" href="#">Report</a></span>\n</div>\n</div>\n</div>\n';if(o.date){_s+='\n<div class="card card-minimap col-xl-2 col-lg-2 col-md-3 col-ms-3 col-sm-4 col-xs-6">\n<div><h3>Access minimap</h3></div>\n<div id ="minimap" class="cleaning-minimap-card"></div>\n</div>\n'}_s+="\n</div>\n";return _s},"tmpl-modal-cleaning":function(o,tmpl){var _e=tmpl.encode,_s="\n";for(var i=0;i<o.length;i++){_s+='\n<tr class="modal-calendar-row">\n<td>'+_e(o[i].id)+"</td>\n<td>"+_e(o[i].datetime)+"</td>\n<td>"+_e(o[i].latlng)+"</td>\t\t\n</tr>\n"}_s+="\n";return _s},"tmpl-modal-garbage":function(o,tmpl){var _e=tmpl.encode,_s="\n";for(var i=0;i<o.length;i++){_s+='\n<tr class="modal-data-row">\n<td>'+_e(o[i].id)+"</td>\t\t\n<td>"+_e(o[i].latlng)+"</td>\t\t\n<td>"+_e(o[i].amount)+"</td>\n<td>"+_e(o[i].types)+"</td>\n</tr>\n"}_s+="\n";return _s},"tmpl-social-links":function(o,tmpl){var _e=tmpl.encode,_s="\n";for(var i=0;i<o.length;i++){_s+='\n<div class="btn-group btn-group-lg" role="group">\n<a href="'+_e(o[i].targeturl)+'" target="_blank" title="'+_e(o[i].title)+'" class="btn '+_e(o[i].btnclass)+' btn-round btn-share"><span class="fa '+_e(o[i].iconclass)+'"></span></a>\n</div>\n'}_s+="\n";return _s},"tmpl-form-garbage-type":function(o,tmpl){var _e=tmpl.encode,_s="\n";for(var i=0;i<o.length;i++){_s+='\n<option value="'+_e(o[i].short)+'">'+_e(o[i].long)+"</option>\n"}_s+="\n";return _s}};tmpl.encReg=/[<>&"'\x00]/g;tmpl.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};tmpl.encode=function(s){return(s==null?"":""+s).replace(tmpl.encReg,function(c){return tmpl.encMap[c]||""})};if(typeof define==="function"&&define.amd){define(function(){return tmpl})}else if(typeof module==="object"&&module.exports){module.exports=tmpl}else{$.tmpl=tmpl}})(this);
var tools={makeEllipsis:function(obj,n){return obj.substr(0,n-1)+(obj.length>n?"&hellip;":"")},insertString:function(obj,index,string){if(index>0){return obj.substring(0,index)+string+obj.substring(index,obj.length)}else{return string+obj}},setMarkerClassColor:function(c){return c===1?"marker-color-limegreen":c===2?"marker-color-yellow":c===3?"marker-color-orangered":c===4?"marker-color-red":"marker-color-violet"},setTodoFullText:function(t){return t==1?" it has been cleaned up already":t==2?" need help to clean it up":t==3?" full bags need to be collected":t==4?" a cleaning needs to be organized":" tell the local authorities"},setPolylineColor:function(c){return c===1?"#ccff66":c===2?"#ffff00":c===3?"#FF4500":c===4?"#ff1a1a":"#e60073"},getCurrentBounds:function(){var bounds=maps.map.getBounds().toBBoxStringInverse();return bounds},cloneLayer:function(layer){var options=layer.options;if(layer instanceof L.Marker){return L.marker(layer.getLatLng(),options)}if(layer instanceof L.Polygon){return L.polygon(layer.getLatLngs(),options)}if(layer instanceof L.Polyline){return L.polyline(layer.getLatLngs(),options)}if(layer instanceof L.LayerGroup||layer instanceof L.FeatureGroup){var layergroup=L.layerGroup();layer.eachLayer(function(inner){layergroup.addLayer(tools.cloneLayer(inner))});return layergroup}throw"Unknown layer, cannot clone this layer"},checkLayerContents:function(oldl,newl){if(oldl.getLayers().length<1){oldl.clearLayers();map.removeLayer(oldl);oldl=tools.cloneLayer(newl);newl.clearLayers();map.removeLayer(newl);oldl.addTo(map);return}if(oldl.getLayers().length>0){if(JSON.stringify(newl.getLayers())!==JSON.stringify(oldl.getLayers())){map.removeLayer(oldl);oldl.clearLayers();oldl=this.cloneLayer(newl);oldl.addTo(map);map.removeLayer(newl);newl.clearLayers();return}else{return}}},getVerticalOffset:function(){var vOffset=[0,0];if(window.innerWidth>767){vOffset[1]=-$(window).height()/4+20}else{vOffset[1]=-$(window).height()/4}return vOffset},getHorizontalOffset:function(){var hOffset=[0,0];hOffset[0]=-$(window).width()/6;return hOffset},getAllFeatures:function(){var allMarkersObjArray=[];var allMarkersGeoJsonArray=[];$.each(maps.map._layers,function(ml){if(maps.map._layers[ml].feature){allMarkersObjArray.push(this);allMarkersGeoJsonArray.push(JSON.stringify(this.toGeoJSON()))}});void 0},mobileMarkerMenu:L.markerMenu({radius:100,size:[50,50],animate:true,duration:200,items:[{title:"Mark garbage",className:"create-dialog fa fa-fw fa-2x fa-marker-menu fa-map-marker",href:"#create-garbage-dialog",click:function(e){e.preventDefault();ui.sidebar.show($("#create-garbage-dialog").show())}},{title:"Create a cleaning event",className:"create-dialog fa fa-fw fa-2x fa-marker-menu fa-calendar-o",href:"create-cleaning-dialog",click:function(e){e.preventDefault();ui.sidebar.show($("#create-cleaning-dialog").show())}},{title:"Mark litter",className:"create-dialog fa fa-fw fa-2x fa-marker-menu fa-ellipsis-h",href:"create-litter-dialog",click:function(e){e.preventDefault()}}]}),clearTempMarkerStyle:function(id){if(id||id!==undefined){var marker=actions.tempmarkers[id];$(marker._icon).removeClass("marker-garbage");$(marker._icon).removeClass("marker-cleaning");$(marker._icon).removeClass(function(index,css){return(css.match(/(^|\s)marker-color-\S+/g)||[]).join(" ")}).addClass("marker-generic");$(marker._icon).addClass("marker-color-gray");if($(window).width()<=567){maps.map.removeLayer(marker)}}},clearTempMarkerStyleListeners:function(id){var marker=actions.tempmarkers[id];ui.sidebar.on("hide",function(){tools.clearTempMarkerStyle(id)});$(".menu-backlink").click(function(e){e.preventDefault();tools.clearTempMarkerStyle(id)});$(".btn-cancel").on("click",function(e){e.preventDefault();ui.sidebar.hide();tools.clearTempMarkerStyle(id);maps.map.removeLayer(marker)})},checkOpenUiElement:function(map){if(ui.sidebar.isVisible()){ui.sidebar.hide();return}if(ui.bottombar.isVisible()){ui.bottombar.hide();return}if($(".dropdown").hasClass("open")){$(".dropdown").removeClass("open");return}if(!maps.layerscontrol.options.collapsed||$(".leaflet-control-layers").hasClass("leaflet-control-layers-expanded")){L.DomEvent.stopPropagation(map);maps.layerscontrol.collapse;return}if($(".leaflet-control-ocd-search").hasClass("leaflet-control-ocd-search-expanded")){maps.geocodercontrol._collapse();L.DomEvent.stopPropagation(map);return}if(maps.locationcontrol._active||maps.locationcontrol._marker){maps.locationcontrol.stop();return}if($(".leaflet-compact-attribution-toggle").is(":checked")){$(".leaflet-compact-attribution-toggle").prop("checked",false);return}if(map.target.getZoom()<15){alerts.showAlert(15,"info",1200);return}if(map._zoom<15){alerts.showAlert(15,"info",1200);return}return true},version:function(){return.3}};
var session=function(){var switchSession=function(sessionStatus){var classicSessionType=localStorage.getItem("classic");if(sessionStatus==="logout"){if(window.innerWidth<768){glomelogincontrol.logout()}$("#session-status a").text("Login").attr("href","#user-login-dialog");$("#session-status a").attr("id","");$("#session-status a").addClass("dropdown-link");$("#user-info-link").remove();$("#user-info-mobile-link").remove();$("#user-tools").dropdown();$(".user-email, .user-glome-key").removeClass("hidden");$(".session-link").removeClass("hidden")}if(sessionStatus==="login"){if(window.innerWidth<768){maps.glomelogincontrol.login()}$("#session-status a").text("Logout").attr("href","#");$("#session-status a").attr("id","btn-logout");$("#session-status a").removeClass("dropdown-link");$("#session-status").on("click","#btn-logout",function(){switchSession("logout");logout()});$("#user-tools").prepend('<li id="user-info-link"><a class="dropdown-link" href="#account-info">User info</a></li>');$("#user-info-link a").on("click",function(e){e.preventDefault();$("#sidebar").scrollTop=0;$(this.hash).fadeIn().siblings().hide();ui.sidebar.show()});$(".mobile-menu").append('<a href="#account-info" id="user-info-mobile-link" class="sidebar-link btn btn-default btn-lg btn-block"><span class="fa fa-fw fa-user"></span> User info</a>');$("#user-info-mobile-link").on("click",function(e){e.preventDefault();$("#sidebar").scrollTop=0;$(this.hash).fadeIn().siblings().hide()});$("#user-tools").dropdown();$(".session-link").addClass("hidden");if(classicSessionType==="true"){$("#account-info").find(".user-email").removeClass("hidden");$("#account-info").find(".user-name").text(localStorage.getItem("username"));$("#account-info").find(".user-email p").html(localStorage.getItem("useremail"));$("#account-info").find(".user-glome-key").addClass("hidden");$("#account-info").find(".user-id").html(localStorage.getItem("userid"));$(".sidebar-content").hide();if(!ui.sidebar.isVisible()){ui.sidebar.show()}$("#account-info").show()}if(classicSessionType==="false"){if(window.innerWidth<768){if(!map.glomelogincontrol){maps.glomelogincontrol.addTo(map);maps.glomelogincontrol.login()}maps.glomelogincontrol.login()}$("#account-info").find(".user-name").text("anon (⌐■_■)");$("#account-info").find(".user-email").addClass("hidden");$("#account-info").find(".user-glome-key p").html(tools.makeEllipsis(localStorage.getItem("glomekey"),25));$("#account-info").find(".user-id").html(localStorage.getItem("userid"));$(".sidebar-content").hide();if(!ui.sidebar.isVisible()){ui.sidebar.show()}$("#account-info").show()}}},login=function(e){e.preventDefault();var email=$("#login-email").val();var password=$("#login-password").val();$.ajax({type:api.createLogin.method,url:api.createLogin.url(),data:{email:email,password:password},success:function(response){localStorage.setItem("token",response.token);$.ajax({method:api.readUser.method,url:api.readUser.url(),headers:{Authorization:"Bearer "+response.token},success:function(data){$("#user-login-dialog").hide();localStorage.setItem("classic","true");localStorage.setItem("username",data.user.name);localStorage.setItem("userid",data.user.id);localStorage.setItem("useremail",data.user.email);void 0;void 0;switchSession("login");alerts.showAlert(13,"success",1500)}})},error:function(response){void 0;alerts.showAlert(24,"danger",2e3);localStorage.removeItem("token")}})},checkLogin=function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({method:api.readUser.method,url:api.readUser.url(),headers:{Authorization:"Bearer "+useToken},success:function(){if(useToken){switchSession("login")}},error:function(){if(useToken){alerts.showAlert(21,"danger",2e3);switchSession("logout");localStorage.clear();ui.sidebar.show($("#user-login-dialog").show().siblings().hide())}}})},logout=function(){if(!localStorage.token){alerts.showAlert(23,"info",2e3);localStorage.clear()}else{var useToken=localStorage.getItem("token")||window.token;$.ajax({method:api.logoutUser.method,url:api.logoutUser.url(),headers:{Authorization:"Bearer "+useToken},success:function(){switchSession("logout");alerts.showAlert(22,"info",2e3);localStorage.clear();if(ui.sidebar.isVisible()){ui.sidebar.hide()}},error:function(){alerts.showAlert(10,"danger",2e3)}})}},register=function(e){e.preventDefault();var email=$("#register-email").val();var name=$("#register-name").val();var password=$("#register-password").val();$.ajax({type:api.createUser.method,url:api.createUser.url(),data:{email:email,password:password,name:name},success:function(response){localStorage.setItem("token",response.token);$("#create-account-dialog").hide();$.ajax({method:api.readUser.method,url:api.readUser.url(),headers:{Authorization:"Bearer "+response.token},success:function(data){void 0;localStorage.setItem("classic","true");localStorage.setItem("username",data.user.name);localStorage.setItem("userid",data.user.id);localStorage.setItem("useremail",data.user.email);switchSession("login");alerts.showAlert(13,"success",2e3)}})},error:function(response){alerts.showAlert(1,"danger",3500);localStorage.removeItem("token")}})},glomeGo=function(){void 0;$.ajax({type:api.createSoftAccount.method,url:api.createSoftAccount.url(),dataType:"json",success:function(response){var glomeid=response.user.name,authUser=response.user,token=response.token;if(!glomeid||typeof glomeid==="undefined"){alerts.showAlert(12,"warning",3e3);return}localStorage.setItem("token",token);localStorage.setItem("glomekey",glomeid);localStorage.setItem("userid",response.user.id);$("#user-login-dialog").hide();$.ajax({method:api.readSoftAccount.method,url:api.readSoftAccount.url(glomeid),headers:{Authorization:"Bearer "+token},dataType:"json",success:function(data){void 0;if(!data||typeof data==="undefined"){return}if(typeof authUser!=="undefined"){localStorage.setItem("classic","false");switchSession("login");alerts.showAlert(13,"success",2e3)}}})},error:function(response){void 0;alerts.showAlert(12,"warning",3e3);localStorage.removeItem("token")}})},deleteAccount=function(e){var classicSessionType=localStorage.getItem("classic");if(classicSessionType==="true"){void 0;e.preventDefault();var useToken=localStorage.getItem("token"),email=localStorage.getItem("useremail"),password=$("#delete-password").val();$.ajax({method:api.removeUser.method,url:api.removeUser.url(),headers:{Authorization:"Bearer "+useToken},data:{email:email,password:password},success:function(){switchSession("logout");alerts.showAlert(17,"success",2e3);localStorage.clear()},error:function(){ui.sidebar.hide();alerts.showAlert(10,"danger",2e3)}})}else{alerts.showAlert(18,"warning",2e3)}},sendKey=function(e){e.preventDefault();var glomeKey=$("#glome-key").val();$.ajax({type:api.checkGlomeKey.method,url:api.receiveGlomeKey.url(),data:{key:glomeKey},success:function(response){localStorage.setItem("token",response.token);void 0;$("#create-account-dialog").hide();switchSession("login");alerts.showAlert(20,"success",2e3);$.ajax({method:"get",url:"http://api.garbagepla.net/api/authenticate/glome",headers:{Authorization:"Bearer "+response.token},success:function(data){void 0;$("#account-info").find(".user-glome-key p").html(data.user.key);$("#account-info").find(".user-email").addClass("hidden");$("#account-info").find(".created-at").html(data.user.created_at);$("#account-info").find(".updated-at").html(data.user.updated_at);$("#account-info").show()}})},error:function(response){void 0;alerts.showAlert(19,"danger",3e3);localStorage.removeItem("token")}})},activate=function(){$(".btn-logout").on("click",session.logout);$(".btn-login").on("click",session.login);$("#registration-form").submit(session.register);$(".btn-glome-go").on("click",session.glomego);$(".btn-glome-key-send").on("click",session.sendkey);$(".btn-delete-account").one("click",session.deleteaccount);if(localStorage.getItem("token")){session.checklogin()}};return{login:login,init:activate,checklogin:checkLogin,logout:logout,register:register,glomego:glomeGo,deleteaccount:deleteAccount,sendkey:sendKey}}();session.init();
var alerts={texts:["You cannot delete features you did not create","Sorry, something went wrong with the server","The request was not handled properly by the server","Please log in to do that","Something went wrong, HTTP error ","Something went wrong while fetching the data","Failed to remove this feature","Feature deleted successfully","You are not on the players list and can't look at this data","You cannot edit feature created by others","Something went wrong","The editing system isn't currently functional","Failed to login anonymously. Reload the page and try again","You are now logged in","Drawing on mobile is still in development, expect issues","Zoom in closer to create features","Couldn't find your position","Account successfully deleted","You cannot delete soft accounts","Sorry. Key not recognized","Welcome back, anonymous","Session expired. Please log in again","You are logged out","No active session","Failed to log in","Marker saved successfully","Cleaning event saved successfully","Litter saved successfully","Area saved successfully","No data in the current area"],showAlert:function(errorCode,errorType,closeDelay){if(!errorType||typeof errorType==="undefined"){var errorType="info"}var errorMessage=this.texts[errorCode];var alertMessage=$('<div class="alert alert-'+errorType+' fade in">').append(errorMessage);$(".alert-container").prepend(alertMessage);if(closeDelay){window.setTimeout(function(){alertMessage.alert("close")},closeDelay)}},showErrorType:function(e){var errortype;if(e.status===200){errortype=this.showAlert(1,"danger",2500)}else if(e.status==="error"){errortype=this.showAlert(2,"danger",2500)}else if(e.status===401||e.status===400){errortype=this.showAlert(3,"danger",2500)}else{errortype=this.showAlert(4+e.status,"danger",2500)}return errortype}};
var maps=function(){var baselayer={"Mapbox Outdoors":L.tileLayer("https://api.tiles.mapbox.com/v4/adriennn.9da931dd/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiYWRyaWVubm4iLCJhIjoiNWQ5ZTEwYzE0MTY5ZjcxYjIyNmExZDA0MGE2MzI2YWEifQ.WGCZQzbVhF87_Z_Yo1aMIQ",{maxZoom:18,reuseTiles:true,updateWhenZooming:true,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>'}),"Mapbox Satellite Street":L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYWRyaWVubm4iLCJhIjoiNWQ5ZTEwYzE0MTY5ZjcxYjIyNmExZDA0MGE2MzI2YWEifQ.WGCZQzbVhF87_Z_Yo1aMIQ",{maxZoom:18,reuseTiles:true,updateWhenZooming:false,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>'}),"Mapbox Dark":L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYWRyaWVubm4iLCJhIjoiNWQ5ZTEwYzE0MTY5ZjcxYjIyNmExZDA0MGE2MzI2YWEifQ.WGCZQzbVhF87_Z_Yo1aMIQ",{maxZoom:18,reuseTiles:true,updateWhenZooming:true,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>'})},map=L.map("map",{zoomControl:false,attributionControl:true}),hash=L.hash(map),garbageLayerGroup=L.markerClusterGroup({spiderfyOnMaxZoom:false,maxClusterRadius:50,disableClusteringAtZoom:15,showCoverageOnHover:false,singleMarkerMode:true}).addTo(map),cleaningLayerGroup=L.markerClusterGroup({spiderfyOnMaxZoom:false,maxClusterRadius:80,disableClusteringAtZoom:15,showCoverageOnHover:false,singleMarkerMode:true,iconCreateFunction:function(cluster){var childCountText=cluster.getChildCount();return L.divIcon({html:'<div><span class="leaflet-marker-cluster-count-cleaning">'+childCountText+'</span><i class="leaflet-marker-cluster-icon-cleaning"></i></div>',className:"leaflet-marker-cluster leaflet-marker-cluster-cleaning",iconSize:[40,40]})}}).addTo(map),litterLayerGroup=L.featureGroup().addTo(map),areaLayerGroup=L.featureGroup().addTo(map),allLayers=L.layerGroup([garbageLayerGroup,areaLayerGroup,cleaningLayerGroup,litterLayerGroup]),overlayGroups={"Garbage markers":garbageLayerGroup,"Cleaning events":cleaningLayerGroup,"Littered coasts and roads":litterLayerGroup,"Tiles and areas":areaLayerGroup},zoomcontrol=L.control.zoom({position:"topleft"}),locationcontrol=L.control.locate({position:"topleft"}),scalecontrol=L.control.scale({metric:true,imperial:false}),layerscontrol=L.control.layers(baselayer,overlayGroups,{position:"topleft"}),geocodercontrol=L.Control.openCageSearch({key:"2bb5bf0d3b9300eacceb225f3cf9cd7d",limit:5,position:"topleft"}),glomelogincontrol=L.control.login(),activate=function(){baselayer["Mapbox Outdoors"].addTo(maps.map);maps.map.doubleClickZoom.disable();zoomcontrol.addTo(maps.map);locationcontrol.addTo(maps.map);scalecontrol.addTo(maps.map);layerscontrol.addTo(maps.map);geocodercontrol.addTo(maps.map);if(window.innerWidth<768){if(!maps.map.glomelogincontrol){maps.glomelogincontrol.addTo(map)}}$(".leaflet-control-layers-toggle").append("<span class='fa fa-2x fa-globe'></span>");$(".leaflet-control-ocd-search-form input").on("submit",function(e){L.DomEvent.stop;L.DomEvent._fakeStop;e.stopImmediatePropagation();e.stopPropagation();e.preventDefault()})},icons=function(){var mapMarker=L.DivIcon.extend({options:{iconSize:[30,30],className:"map-marker",html:'<i class="fa fa-fw"></i>'}}),mapmarker=function(options){return new mapMarker(options)},genericMarker=mapmarker({className:"map-marker marker-color-gray marker-generic"}),garbageMarker=mapmarker({className:"map-marker marker-garbage"}),cleaningMarker=mapmarker({className:"map-marker marker-cleaning"}),dieoffMarker=mapmarker({className:"map-marker marker-dieoff"}),sewageMarker=mapmarker({className:"map-marker marker-sewage"}),floatingMarker=mapmarker({className:"map-marker marker-floating"});return{genericMarker:genericMarker,garbageMarker:garbageMarker,cleaningMarker:cleaningMarker,dieoffMarker:dieoffMarker,sewageMarker:sewageMarker,floatingMarker:floatingMarker}}(),localTrashBins=function(){maps.osmTrashbinLayer=new L.OverPassLayer({query:'(node["amenity"="waste_basket"]({{bbox}});node["amenity"="recycling"]({{bbox}});node["amenity"="waste_disposal"]({{bbox}}););out;'});maps.map.addLayer(maps.osmTrashbinLayer)};return{init:activate,map:map,hash:hash,trashBins:localTrashBins,locationcontrol:locationcontrol,glomelogincontrol:glomelogincontrol,layerscontrol:layerscontrol,geocodercontrol:geocodercontrol,zoomcontrol:zoomcontrol,garbageLayerGroup:garbageLayerGroup,areaLayerGroup:areaLayerGroup,litterLayerGroup:litterLayerGroup,cleaningLayerGroup:cleaningLayerGroup,allLayers:allLayers,icons:icons}}();maps.init();var locating=function(){var coordsinhrf=window.location.href.match(/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\/*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)/),checkHref=function(){if(!coordsinhrf){maps.locationcontrol.start()}},onLocationFound=function(e){maps.map.setView(e.latlng,18)},onLocationError=function(e){alerts.showAlert(16,"warning",2e3);if(coordsinhrf){maps.locationcontrol.stop()}else{maps.map.setView([0,0],2)}};maps.map.on("locationerror",onLocationError);maps.map.on("locationfound",onLocationFound);if(!coordsinhrf){maps.map.locate()}}();
var ui=function(){var credits=[{title:"homepage",linkurl:"http://home.garbagepla.net/",text:"Project"},{title:"Let's Encrypt",linkurl:"https://letsencrypt.org/",text:"Secured with"},{title:"Mapbox",linkurl:"https://www.mapbox.com/",text:"Basemaps imagery ©"},{title:"Openstreetmap and contributors",linkurl:"http://www.openstreetmap.org/",text:"Maps and underlying data ©"},{title:"Overpass API",linkurl:"http://www.overpass-api.de/",text:"POIs retrieved using the"},{title:"OpenCage Geocoder",linkurl:"https://geocoder.opencagedata.com/",text:"Address search and geocoding using"},{title:"Leaflet 1.0",linkurl:"https://leafletjs.com/",text:"Mapping done with "},{title:"FontAwesome",linkurl:"http://fontawesome.io/",text:"Icons by"},{title:"Bootstrap 3",linkurl:"http://getbootstrap.com/",text:"Built with"},{title:"JQuery",linkurl:"https://jquery.com/",text:"Runs on"},{title:"Laravel 5.1",linkurl:"https://laravel.com/",text:"Backed by"},{title:"JavaScript-Templates",linkurl:"https://github.com/blueimp/JavaScript-Templates",text:"Templating with"},{title:"Github",linkurl:"https://github.com/garbageplanet",text:"Source code available on"}],activate=function(){this.sidebar.addTo(maps.map);this.bottombar.addTo(maps.map);document.getElementById("credits").innerHTML=tmpl("tmpl-credits",credits);ui.mobile()},sidebar=L.control.sidebar("sidebar",{position:"right",closebutton:"true"}),bottombar=L.control.sidebar("bottombar",{position:"bottom",closebutton:"true"}),pushDataToBottomPanel=function(obj){void 0;var feature=obj,featuredata=obj.options;if(!featuredata){featuredata=obj}document.getElementById("bottombar-content-container").innerHTML=tmpl("tmpl-feature-info",featuredata);social.shareThisFeature(featuredata);document.getElementById("social-links").innerHTML=tmpl("tmpl-social-links",social.network);ui.bottombar.show($("#feature-info").fadeIn());if(featuredata.image_url){var image_url_insert=tools.insertString(featuredata.image_url,26,"b");$("#feature-info").find(".feature-image").attr("src",image_url_insert)}$("#feature-info").find(".btn-edit").on("click",function(){if(localStorage.getItem("token")){actions.editFeature(featuredata)}else{alerts.showAlert(3,"warning",2e3)}});$("#feature-info").find(".btn-cleaned").on("click",function(){actions.cleanedGarbage(featuredata)});$("#feature-info").find(".btn-confirm-garbage").on("click",function(){actions.confirmGarbage(featuredata)});$("#feature-info").find(".btn-attend-cleaning").on("click",function(){actions.attendCleaning(featuredata)});$("#feature-info").find(".btn-participate-game").on("click",function(){actions.participateGame(featuredata)});$(".btn-social").popover({html:true,container:"body",placement:function(pop){if(window.innerWidth<560){return"top"}else{return"right"}},content:function(){return $("#social-links").html()},template:'<div class="popover popover-share" role="tooltip"><div class="popover-content popover-share"></div></div>'});$("#feature-info").find(".btn-delete").on("click",function(e){e.preventDefault();actions.deleteFeature(feature)})},makeModal=function(type,arr){var template,modaltmplclass,modaltableclass,modaltablebodyclass;void 0;if(typeof arr!=="undefined"&&arr.length>0){if(type=="garbage"){template='<div id="modal-data" class="modal" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close pull-right" data-dismiss="modal"><span class="fa fa-fw fa-times"></span></button><h4 class="modal-title">View and download data from garbagepla.net</h4></div><div class="modal-body"><table id="modal-garbage-table" class="table-striped table-condensed"><thead><tr><th>Feature id</th><th>Coordinates</th><th>Amount</th><th>Garbage types</th></tr></thead><tbody id="modal-garbage-table-body"></tbody></table></div><div class="modal-footer"><a class="disabled pull-left" href="#">Get the full data</a><form><button type="button" data-dismiss="modal" class="btn btn-danger pull-right ">Close</button><button id="modal-data-load-more" type="button" class="btn btn-default pull-right ">Zoom out and load more</button><a id="modal-download" href="" target="_blank" data-download="data.txt" type="button" class="btn btn-default pull-right">Download</a></form></div></div></div></div>'}if(type=="cleaning"){template='<div id="modal-calendar" class="modal" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close pull-right" data-dismiss="modal"><span class="fa fa-fw fa-times"></span></button><h4 class="modal-title">Cleaning events calendar</h4></div><div class="modal-body"><table id="modal-calendar-table" class="table-striped table-condensed"><thead><tr><th>Event id</th><th>Date</th><th>Coordinates</th><th>Address</th></tr></thead><tbody id="modal-calendar-table-body"></tbody></table></div><div class="modal-footer"><form><button type="button" data-dismiss="modal" class="btn btn-danger pull-right ">Close</button><button id="modal-calendar-load-more" type="button" class="btn btn-default pull-right ">Zoom out and load more</button><a id="modal-download" href="" target="_blank" data-download="data.txt" type="button" class="btn btn-default pull-right">Download</a></form></div></div></div></div>'}if(type=="game"){template='<div id="modal-calendar" class="modal" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close pull-right" data-dismiss="modal"><span class="fa fa-fw fa-times"></span></button><h4 class="modal-title">Cleaning events calendar</h4></div><div class="modal-body"><table id="modal-calendar-table" class="table-striped table-condensed"><thead><tr><th>Event id</th><th>Date</th><th>Coordinates</th><th>Address</th></tr></thead><tbody id="modal-calendar-table-body"></tbody></table></div><div class="modal-footer"><form><button type="button" data-dismiss="modal" class="btn btn-danger pull-right ">Close</button><button id="modal-calendar-load-more" type="button" class="btn btn-default pull-right ">Zoom out and load more</button><a id="modal-download" href="" target="_blank" data-download="data.txt" type="button" class="btn btn-default pull-right">Download</a></form></div></div></div></div>'}modaltmplclass="tmpl-modal-"+type;modaltableclass="modal-"+type+"-table";modaltablebodyclass="modal-"+type+"-table-body";void 0;$("body").append(template);document.getElementById(modaltablebodyclass).innerHTML=tmpl(modaltmplclass,arr);$("#modal-data").modal("show");$(modaltableclass).DataTable();$("#modal-data-load-more").on("click",function(){maps.map.setZoom(maps.map.getZoom()-1);$(".modal-data-row").empty();document.getElementById(modaltablebodyclass).innerHTML=tmpl(modaltmplclass,arr)});$("#modal-download").on("click",function(e){void 0;e.preventDefault;var stringdata="text/json;charset=utf-8,"+JSON.stringify(arr);this.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(stringdata))})}else{alerts.showAlert(29,"warning",2e3)}},checkMobile=function(){if(window.innerWidth>=768){$("#mobile-menu-dialog").remove()}if(window.innerWidth<768){$("#topbar").remove();maps.map.removeControl(maps.zoomcontrol);$("body").append('<div class="swipe-area swipe-area-right"></div>');$("#sidebar").append('<div class="swipe-area swipe-area-left"></div>');$("#bottombar").prepend('<div class="swipe-area swipe-area-top"></div>');$(".draw-link").addClass("disabled");$(".garbage-type-select, .litter-type-select").attr("data-live-search","false");$(".swipe-area-right").touchwipe({wipeLeft:function(){sidebar.show($("#mobile-menu-dialog").show())},min_move_x:15,preventDefaultEvents:true});$(".swipe-area-left").touchwipe({wipeRight:function(){sidebar.hide()},min_move_x:15,preventDefaultEvents:true});$(".swipe-area-top").touchwipe({wipeUp:function(){bottombar.hide()},min_move_y:20,preventDefaultEvents:true})}},uiEventListeners=$(function(){$(".sidebar-link").click(function(e){e.preventDefault();$(this.hash).fadeIn().siblings().hide();$("#sidebar").scrollTop=0});$(".menu-backlink").click(function(e){e.preventDefault();$(".panel-collapse").collapse("hide");$("#sidebar").scrollTop=0;$(this.hash).fadeIn().siblings().hide()});ui.sidebar.on("hide",function(){$(".sidebar-content").hide();$(".sidebar-container",".sidebar-content").scrollTop=0;$("form").each(function(){this.reset()});$("input").val("");$(".selectpicker").selectpicker("render");$(".tab-default").tab("show");$(".leaflet-draw-edit-edit").removeClass("visible");$(".leaflet-draw-edit-remove").removeClass("visible")});$("#user-tools").on("click","a",function(e){if($(this).hasClass("dropdown-link")){e.preventDefault();ui.bottombar.hide();ui.sidebar.show();$(this.hash).fadeIn().siblings().hide()}});$("#btn-trashbins").on("click",function(){maps.trashBins()});ui.bottombar.on("hide",function(e){$(".btn-social").popover("destroy");$(".modal").modal("hide").data("bs.modal",null)});ui.bottombar.on("show",function(){if(ui.sidebar.isVisible()){ui.sidebar.hide()}if($(".leaflet-control-ocd-search").hasClass("leaflet-control-ocd-search-expanded")){maps.geocodercontrol._collapse()}});$(".modal-link").on("click",function(e){void 0;if($(this).hasClass("modal-list-garbage")){makeModal("garbage",features.garbageArray())}if($(this).hasClass("modal-list-cleaning")){makeModal("cleaning",features.cleaningArray())}})});return{init:activate,sidebar:sidebar,bottombar:bottombar,pushDataToBottomPanel:pushDataToBottomPanel,makeModal:makeModal,mobile:checkMobile}}();ui.init();
var features=function(){"use strict";var garbageArray=[],cleaningArray=[],loadGarbageMarkers=function(){garbageArray=[];setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({type:api.readTrashWithinBounds.method,url:api.readTrashWithinBounds.url(tools.getCurrentBounds()),success:function(data){maps.garbageLayerGroup.clearLayers();$(data).each(function(index,obj){garbageArray.push(obj);var latlng=obj.latlng.toString().replace(/,/g,"").split(" ");var marker=L.marker(L.latLng(latlng[0],latlng[1]),{icon:maps.icons.garbageMarker,id:obj.id,amount:obj.amount,types:obj.types.join(", "),image_url:obj.image_url,latlng:obj.latlng,confirms:obj.confirms,todo:tools.setTodoFullText(obj.todo),tags:obj.tag,note:obj.note,feature_type:"marker_garbage",size:obj.size,embed:obj.embed,created_by:obj.marked_by,created_at:obj.created_at,modified_at:obj.updated_at,cleaned:obj.cleaned,cleaned_by:obj.cleaned_by,cleaned_date:obj.cleaned_date});marker.addTo(maps.garbageLayerGroup);$(marker._icon).addClass(tools.setMarkerClassColor(obj.amount));marker.on("click",function(e){actions.featureClick(e,this)})})},error:function(data){void 0;alerts.showAlert(10,"warning",1500)}})},100)},loadCleaningMarkers=function(){cleaningArray=[];setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({type:api.readCleaningWithinBounds.method,url:api.readCleaningWithinBounds.url(tools.getCurrentBounds()),success:function(data){maps.cleaningLayerGroup.clearLayers();$(data).each(function(index,obj){cleaningArray.push(obj);var latlng=obj.latlng.toString().replace(/,/g,"").split(" ");var marker=L.marker(L.latLng(latlng[0],latlng[1]),{icon:maps.icons.cleaningMarker,id:obj.id,datetime:obj.datetime,latlng:obj.latlng,feature_type:"marker_cleaning",attends:obj.attends,recurrence:obj.recurrence,created_by:obj.created_by,created_at:obj.created_at,modified_at:obj.updated_at});marker.addTo(maps.cleaningLayerGroup);$(marker._icon).addClass("marker-color-blue");marker.on("click",function(e){actions.featureClick(e,this)})})},error:function(data){void 0}})},200)},loadAreas=function(){setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({type:api.readAreaWithinBounds.method,url:api.readAreaWithinBounds.url(tools.getCurrentBounds()),headers:{Authorization:"Bearer "+useToken},success:function(data){maps.areaLayerGroup.clearLayers();$(data).each(function(index,obj){var latlngs=JSON.parse("["+obj.latlngs+"]");var polygonLayer=new L.Polygon(latlngs,{id:obj.id,title:obj.title,max_players:obj.max_players,curr_players:obj.curr_players,note:obj.note,tags:obj.tag,contact:obj.contact,feature_type:"polygon_area",shape:true,created_by:obj.created_by,created_at:obj.created_at,modified_at:obj.updated_at,color:"#33cccc",weight:5,opacity:.5,smoothFactor:3});maps.areaLayerGroup.addLayer(polygonLayer);polygonLayer.on("click",function(e){actions.featureClick(e,polygonLayer)})})},error:function(data){void 0}})},400)},loadLitters=function(){setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({type:api.readLitterWithinBounds.method,url:api.readLitterWithinBounds.url(tools.getCurrentBounds()),headers:{Authorization:"Bearer "+useToken},success:function(data){maps.litterLayerGroup.clearLayers();$(data).each(function(index,obj){var latlngs=JSON.parse("["+obj.latlngs+"]");var polylineLayer=L.polyline(latlngs,{id:obj.id,amount:obj.amount,types:obj.types.join(", "),image_url:obj.image_url,tags:obj.tag,shape:true,feature_type:"polyline_litter",created_by:obj.marked_by,cleaned:obj.cleaned,confirms:obj.confirms,cleaned_by:obj.cleaned_by,created_at:obj.created_at,modified_at:obj.updated_at,physical_length:obj.physical_length,weight:15,opacity:.5,smoothFactor:3,color:tools.setPolylineColor(obj.amount),clickable:true});maps.litterLayerGroup.addLayer(polylineLayer);polylineLayer.on("click",function(e){actions.featureClick(e,polylineLayer)})})},error:function(data){void 0}})},300)},loadAllFeatures=function(){loadGarbageMarkers();loadCleaningMarkers();loadAreas();loadLitters()};maps.map.addOneTimeEventListener("ready",function(){features.loadAllFeatures()});maps.map.on("dragend zoomend",function(e){void 0;if(e.type==="zoomend"){if(e.target.getZoom()>=2){loadGarbageMarkers();loadCleaningMarkers();if(e.target.getZoom()<=16){loadLitters();loadAreas()}}if(e.target.getZoom()<7){maps.areaLayerGroup.clearLayers;maps.litterLayerGroup.clearLayers}}if(e.type==="dragend"){if(e.distance>=window.innerWidth/3){if(e.target.getZoom()>=2){loadGarbageMarkers();loadCleaningMarkers();if(e.target.getZoom()>=8&&e.target.getZoom()<=16){loadLitters();loadAreas()}}}}});return{garbageArray:function(){return garbageArray},cleaningArray:function(){return cleaningArray},loadGarbageMarkers:loadGarbageMarkers,loadCleaningMarkers:loadCleaningMarkers,loadAreas:loadAreas,loadLitters:loadLitters,loadAllFeatures:loadAllFeatures}}();
var actions=function(){"use strict";var tempmarkers=[],mapClick=function(map){void 0;if(!tools.checkOpenUiElement(map)){return}else{var marker,markerid;if($(window).width()>767){marker=L.marker(map.latlng,{icon:maps.icons.genericMarker,draggable:true,feature_type:"marker_generic"});marker.addTo(maps.map);markerid=marker._leaflet_id;actions.tempmarkers[markerid]=marker;maps.map.panToOffset(marker.getLatLng(),tools.getHorizontalOffset());$(".sidebar-content").hide();$("#sidebar").scrollTop=0;ui.sidebar.show($("#create-marker-dialog").show());marker.on("click",actions.unsavedMarkerClick);marker.on("dragend",function(event){var newPos=event.target.getLatLng();$(".marker-latlng").val(newPos.lat+", "+newPos.lng)});marker.on("click",actions.unsavedMarkerClick);actions.passMarkerToForm(markerid);tools.clearTempMarkerStyleListeners(markerid);return}if($(window).width()<768){if(!$(".leaflet-marker-menu").is(":visible")){marker=L.marker(map.latlng,{icon:maps.icons.genericMarker,draggable:false,feature_type:"marker_generic"});marker.addTo(maps.map);markerid=marker._leaflet_id;actions.tempmarkers[markerid]=marker;marker.setMenu(tools.mobileMarkerMenu);maps.map.panTo(marker.getLatLng());marker.on("click",actions.unsavedMarkerClick);tools.clearTempMarkerStyleListeners(markerid);if(!marker._menu._isOpened){marker.setZIndexOffset(1e3);marker.openMenu();actions.passMarkerToForm(markerid);return}return}}}},unsavedMarkerClick=function(){"use strict";var markerid=this._leaflet_id,marker=actions.tempmarkers[markerid],latlng=marker.getLatLng(),menu=this._menu;void 0;void 0;actions.passMarkerToForm(markerid);ui.bottombar.hide();if($(window).width()<=768){if(menu){marker.setZIndexOffset(500);return}if(!menu){marker.setMenu(actions.mobileMarkerMenu);maps.map.panTo(marker.getLatLng());marker.openMenu();return}}if($(window).width()>768){maps.map.panToOffset(latlng,tools.getHorizontalOffset());$("#sidebar").scrollTop=0;$(".sidebar-content").hide();ui.sidebar.show($("#create-marker-dialog").fadeIn());marker.on("dragend",function(event){var newpos=event.target.getLatLng();$(".marker-latlng").val(newpos.lat+", "+newpos.lng)})}},featureClick=function(e,obj){void 0;void 0;L.DomEvent.stopPropagation(e);if(obj.options){if(obj.options.shape){maps.map.panToOffset(obj.getCenter(),tools.getVerticalOffset());ui.pushDataToBottomPanel(obj)}if(!obj.options.shape){var currentZindex=obj._zIndex;obj.setZIndexOffset(currentZindex+1e4);maps.map.panToOffset(obj.getLatLng(),tools.getVerticalOffset());ui.pushDataToBottomPanel(obj)}}},editFeature=function(e){var userid=localStorage.getItem("userid");if(userid==e.marked_by){ui.bottombar.hide();alerts.showAlert(11,"warning",3e3);if(e.feature_type==="marker_garbage"){ui.sidebar.show($("#create-garbage-dialog").fadeIn())}if(e.feature_type==="marker_cleaning"){ui.sidebar.show($("#create-cleaning-dialog").fadeIn())}if(e.feature_type==="polyline_litter"){ui.sidebar.show($("#create-litter-dialog").fadeIn())}if(e.feature_type==="polygon_area"){ui.sidebar.show($("#create-area-dialog").fadeIn())}}else{alerts.showAlert(9,"danger",3e3)}},confirmGarbage=function(e){if(!localStorage.getItem("token")){alerts.showAlert(3,"info",2e3)}else{var callurl=null;if(e.feature_type==="marker_garbage"){callurl=api.confirmTrash.url(e.id)}else if(e.feature_type==="polyline_litter"){callurl=api.confirmLitter.url(e.id)}setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({method:"PUT",url:callurl,headers:{Authorization:"Bearer"+useToken},success:function(response){var message=response.data.message;ui.pushDataToBottomPanel(response.data.data);if(message.indexOf("litter")===0){features.loadLitters()}else{features.loadGarbageMarkers()}},error:function(err){alerts.showAlert(10,"info",2e3)}})},100)}},deleteFeature=function(o){void 0;if(o.options.feature_type){switch(o.options.feature_type){case"marker_cleaning":var deletemethod=api.deleteCleaning.method;var deleteurl=api.deleteCleaning.url(o.options.id);break;case"polyline_litter":var deletemethod=api.deleteLitter.method;var deleteurl=api.deleteLitter.url(o.options.id);break;case"polygon_area":var deletemethod=api.deleteArea.method;var deleteurl=api.deleteArea.url(o.options.id);break;case"marker_garbage":var deletemethod=api.deleteTrash.method;var deleteurl=api.deleteTrash.url(o.options.id);break}var useToken=localStorage.getItem("token")||window.token;if((o.options.marked_by||o.options.created_by)==localStorage.getItem("userid")){$.ajax({type:deletemethod,url:deleteurl,headers:{Authorization:"Bearer "+useToken},success:function(response){ui.bottombar.hide();maps.map.removeLayer(o);alerts.showAlert(7,"success",1500)},error:function(response){void 0;alerts.showAlert(6,"warning",2e3)}})}else{ui.bottombar.hide();alerts.showAlert(0,"danger",2500)}}else{ui.bottombar.hide();alerts.showAlert(10,"warning",2500)}},attendCleaning=function(e){if(!localStorage.getItem("token")){alerts.showAlert(3,"info",2e3)}else{setTimeout(function(){var useToken=localStorage.getItem("token")||window.token,id=e.id;$.ajax({method:"PUT",url:api.attendCleaning.url(id),headers:{Authorization:"Bearer"+useToken},success:function(response){ui.pushDataToBottomPanel(response.data.data);features.loadCleaningMarkers()},error:function(err){alerts.showAlert(10,"info",2e3)}})},100)}},participateGame=function(){},cleanedGarbage=function(e){if(!localStorage.getItem("token")){alerts.showAlert(3,"info",2e3)}else{setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({method:api.confirmTrash.method,url:api.confirmTrash.url(),headers:{Authorization:"Bearer"+useToken},data:{clean:1},success:function(data){void 0},error:function(err){void 0}})},100)}},passMarkerToForm=function(id){"use strict";var id=id;$(".create-dialog").on("click",function(e){e.preventDefault();if(e.target&&id){void 0;var ct=$(this).attr("href").toString();void 0;if(ct.indexOf("garbage")!==-1){forms.makeGarbageForm(id);return}if(ct.indexOf("cleaning")!==-1){forms.makeCleaningForm(id);return}if(ct.indexOf("wastewater")!==-1){forms.makeWastewaterForm(id);return}if(ct.indexOf("dieoff")!==-1){forms.makeDieoffForm(id);return}if(ct.indexOf("floating")!==-1){forms.makeFloatingForm(id);return}if(ct.indexOf("area")!==-1||ct.indexOf("litter")!==-1){return}}})};return{mapClick:mapClick,unsavedMarkerClick:unsavedMarkerClick,featureClick:featureClick,editFeature:editFeature,confirmGarbage:confirmGarbage,deleteFeature:deleteFeature,attendCleaning:attendCleaning,participateGame:participateGame,cleanedGarbage:cleanedGarbage,passMarkerToForm:passMarkerToForm,tempmarkers:tempmarkers}}();maps.map.on("click",actions.mapClick);
window.token="eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOjYsImlzcyI6Imh0dHA6XC9cL2FwaS5nYXJiYWdlcGxhLm5ldFwvYXBpXC9hdXRoZW50aWNhdGUiLCJpYXQiOiIxNDQ2OTAxNTcxIiwiZXhwIjoiMTQ0NjkwNTE3MSIsIm5iZiI6IjE0NDY5MDE1NzEiLCJqdGkiOiJhMzljOTg1ZDZmNWNjNmU4MGNlMmQzOWZjODg5NWM1YSJ9.R28VF7VI1S3-PpvaG6cjpyxpygvQCB0JXF5oQ27TxCw";var saving=function(){var activate=$(function(){$(".form-garbage").on("submit",saving.saveGarbage);$(".form-cleaning").on("submit",saving.saveCleaning);$(".form-litter").on("submit",saving.saveLitter);$(".form-area").on("submit",saving.saveArea)}),saveGarbage=function(e){e.preventDefault();var that=this,garbageType=[],tags=[],garbageTodo,garbageAmount,latlng,image_url,garbageSize=[],garbageEmbed=[],note;$(this).find(".selectpicker.garbage-type-select option:selected").each(function(index,value){garbageType.push($(value).val())});garbageTodo=$(this).find(".selectpicker.garbage-todo-select option:selected").val();$(this).find(".selectpicker.garbage-size-select option:selected").each(function(index,value){garbageSize.push($(value).val())||""});$(this).find(".selectpicker.garbage-embed-select option:selected").each(function(index,value){garbageEmbed.push($(value).val())||""});garbageAmount=$(".btn-group-amount").find(".active > input").attr("name")||"3";note=$(this).find(".garbage-note").val()||"";image_url=$(this).find(".garbage-image-hidden-value").val()||"";tags=$(this).find(".garbage-tags").tagsinput("items")||"";latlng=$(this).find(".garbage-latlng").val();if(!latlng||!garbageAmount){alerts.showAlert(10,"danger",1500);return}setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({method:api.createTrash.method,url:api.createTrash.url(),headers:{Authorization:"Bearer "+useToken},data:{latlng:latlng,amount:garbageAmount,types:garbageType.join(),todo:garbageTodo,image_url:image_url,tag:tags.join(),sizes:garbageSize.join(),embed:garbageEmbed.join(),note:note},success:function(data){void 0;alerts.showAlert(25,"success",1500);ui.sidebar.hide("slow");features.loadGarbageMarkers()},error:function(response){alerts.showAlert(10,"danger",1500);ui.sidebar.hide()}})},100)},saveCleaning=function(e){e.preventDefault();var that=this,tags=[],eventRecurrence,dateTime,note,latlng;dateTime=$("#date-time-value").val();tags=$(this).find(".cleaning-tags").tagsinput("items")||"";note=$(this).find(".cleaning-note").val()||"";latlng=$(this).find(".cleaning-latlng").val();eventRecurrence=$(this).find(".selectpicker.cleaning-recurrent-select option:selected").val();if(!latlng||!dateTime){alerts.showAlert(10,"danger",1500);return}setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({method:api.createCleaning.method,url:api.createCleaning.url(),headers:{Authorization:"Bearer "+useToken},dataType:"json",data:{latlng:latlng,datetime:dateTime,note:note,recurrence:eventRecurrence,tag:tags.join()},success:function(data){alerts.showAlert(26,"success",2e3);ui.sidebar.hide("slow");features.loadCleaningMarkers()},error:function(response){alerts.showAlert(10,"danger",1500);ui.sidebar.hide()}})},100)},saveLitter=function(e){$(".btn-draw").removeClass("disabled");e.preventDefault();var that=this,litterType=[],tags=[],litterAmount,latlngs,image_url,length,note,amount_quantitative;latlngs=$(this).find(".litter-latlngs").val();$(this).find(".selectpicker.litter-type-select option:selected").each(function(index,value){litterType.push($(value).val())});tags=$(this).find(".litter-tags").tagsinput("items")||"";amount_quantitative=$(this).find(".litter-amount-quantitative").val()||"";litterAmount=$(".btn-group-amount-litter").find(".active > input").attr("name")||"3";physical_length=$(this).find(".litter-path-length").val()||"";image_url=$(this).find(".litter-image-hidden-value").val()||"";note=$("input[class=litter-note]").val()||"";if(!latlngs){alerts.showAlert(10,"danger",1500);return}setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({method:api.createLitter.method,url:api.createLitter.url(),headers:{Authorization:"Bearer "+useToken},dataType:"json",data:{latlngs:latlngs.toString(),amount:litterAmount,types:litterType.join(),image_url:image_url,tag:tags.join()},success:function(data){void 0;alerts.showAlert(26,"success",1500);ui.sidebar.hide("slow");features.loadLitters()},error:function(response){alerts.showErrorType(response);ui.sidebar.hide();map.removeLayer(polylineLayer)}})},200)},saveArea=function(e){$(".btn-draw").removeClass("disabled");e.preventDefault();var that=this,tags=[],latlngs,note,secret,max_players,title,contact,game;game=$(".tile-game-check input:checked").length||0;void 0;latlngs=$(this).find(".area-latlngs").val();title=$(this).find(".area-title").val();note=$(this).find(".area-note").val()||"";secret=$(this).find(".area-secret").val()||"";contact=$(this).find(".area-contact").val()||"";max_players=$(this).find(".area-players").val()||"";tags=$(this).find(".area-tags").tagsinput("items")||"";function randomString(len){var randomStringValue=" ",charset="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(var i=0;i<len;i++){randomStringValue+=charset.charAt(Math.floor(Math.random()*charset.length))}return randomStringValue}if(!title){title=randomString(12);void 0}setTimeout(function(){var useToken=localStorage.getItem("token")||window.token;$.ajax({method:api.createArea.method,url:api.createArea.url(),headers:{Authorization:"Bearer "+useToken},dataType:"json",data:{latlngs:latlngs,note:note,contact:contact,secret:secret,title:title,tag:tags.join(),game:game},success:function(data){void 0;alerts.showAlert(27,"success",1500);ui.sidebar.hide("slow");features.loadAreas()},error:function(response){alerts.showErrorType(response);ui.sidebar.hide();map.removeLayer(polygoneLayer)}})},200)},checkForm=function(){};return{saveGarbage:saveGarbage,saveCleaning:saveCleaning,saveLitter:saveLitter,saveArea:saveArea,init:activate}}();
var forms=function(){var activate=function(){document.getElementById("garbage-select").innerHTML=tmpl("tmpl-form-garbage-type",forms.garbagetypes);document.getElementById("litter-select").innerHTML=tmpl("tmpl-form-garbage-type",forms.garbagetypes);$(".selectpicker").selectpicker({style:"btn-lg btn-default text-center",size:6});$(".feature-tags").tagsinput({maxTags:3,confirmKeys:[32,39],maxChars:16,trimValue:true});$(".form-feature").bind("keypress",function(e){if(e.keyCode===13){$(".btn-save").attr("type");e.preventDefault()}})},garbagetypes=[{"short":"plastic","long":"Plastic items"},{"short":"bags","long":"Plastic bags"},{"short":"foodpacks","long":"Plastic food containers"},{"short":"pet","long":"PET bottles"},{"short":"party","long":"Party leftovers"},{"short":"fastfood","long":"Fastfood garbage"},{"short":"poly","long":"Expanded plastic polymers"},{"short":"butts","long":"Cigarette butts"},{"short":"glassb","long":"Broken glass"},{"short":"glass","long":"Glass"},{"short":"bottles","long":"Glass bottles"},{"short":"metal","long":"Metal"},{"short":"tin","long":"Tin cans"},{"short":"alu","long":"Aluminium cans"},{"short":"wood","long":"Plywood and treated or painted wood"},{"short":"chemicals","long":"Chemicals"},{"short":"household","long":"Household garbage"},{"short":"clothes","long":"Shoes and clothes"},{"short":"fabric","long":"Carpets and fabrics"},{"short":"matress","long":"Matresses"},{"short":"tarp","long":"Tarps and other large covers"},{"short":"electronic","long":"Electronics"},{"short":"electric","long":"Electric appliances"},{"short":"batt","long":"Batteries"},{"short":"industrial","long":"Industrial wastes"},{"short":"construction","long":"Construction wastes"},{"short":"gas","long":"Gasoline and petroleum oil"},{"short":"crude","long":"Crude oil"},{"short":"vehicle","long":"Large vehicle"},{"short":"bicycle","long":"Bicycles"},{"short":"motorcyle","long":"Motorcycles"},{"short":"tyres","long":"Tyres"},{"short":"engine","long":"Engine parts"},{"short":"parts","long":"Vehicles parts"},{"short":"fishing","long":"Fishing gears"},{"short":"commercial","long":"Commercial fishing equipment"},{"short":"net","long":"Fishing net"},{"short":"lines","long":"Fishing line"},{"short":"boat","long":"Small boat"},{"short":"vessel","long":"Large boat or wreck"},{"short":"boating","long":"Boating equipment"},{"short":"buoy","long":"Buoys and floats"},{"short":"maritime","long":"Maritime equipment"},{"short":"sew","long":"Sewage"},{"short":"dogs","long":"Dog poop bags"}],makeGarbageForm=function(id){"use strict";void 0;void 0;var marker=actions.tempmarkers[id],latlng=marker.getLatLng();void 0;if(marker){$(".marker-latlng").val(latlng.lat+", "+latlng.lng);$("input[type=radio]").on("change",function(){$(marker._icon).removeClass("marker-generic").addClass("marker-garbage");var selectedValue=parseInt($(this).attr("name"),10);$(marker._icon).removeClass(function(index,css){return(css.match(/(^|\s)marker-color-\S+/g)||[]).join(" ")}).addClass(tools.setMarkerClassColor(selectedValue))})}},makeCleaningForm=function(id){var marker=actions.tempmarkers[id],latlng=marker.getLatLng();$(".marker-latlng").val(latlng.lat+", "+latlng.lng);$("#event-date-time-picker").datetimepicker({minDate:new Date(2016,4,1),showClose:true,ignoreReadonly:true,focusOnShow:false,toolbarPlacement:"top"});$("#event-date-time-picker").on("dp.change",function(e){var eventDateTime=e.date.format("YYYY-MM-DD HH:MM:SS");$("#date-time-value").val(eventDateTime);$(marker._icon).removeClass("marker-color-gray marker-generic").addClass("marker-cleaning marker-color-blue")})},makeLitterForm=function(id){},makeAreaForm=function(id){},uploader=$(function(){$(".image-uploader").fileupload({headers:{Authorization:"Client-ID 6f050e213f46ba9"},type:"POST",url:"https://api.imgur.com/3/upload",dataType:"json",paramName:"image",progressall:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);$(".progress").removeClass("hidden");$(".progress-bar").css("width",progress+"%")},fail:function(err){void 0;$(".progress").addClass("hidden").delay(400)},error:function(err){void 0;$(".progress").addClass("hidden").delay(400)},done:function(e,data){void 0;$(e.target).parent().next().val(data.result.data.link);$(".progress").addClass("hidden").delay(200)}});$(".btn-image-uploader").on("click",function(){if(localStorage.getItem("token")){$(this).next().trigger("click")}else{alerts.showAlert(3,"warning",2e3);return}})});return{init:activate,garbagetypes:garbagetypes,makeGarbageForm:makeGarbageForm,makeCleaningForm:makeCleaningForm,makeLitterForm:makeLitterForm,makeAreaForm:makeAreaForm}}();forms.init();
var devTour=new Tour({name:"dev-tour",template:"<div class='popover tour'><div class='arrow'></div><div class='popover-content'></div><div class='popover-navigation'><a class='btn-tour' data-role='end'><i class='fa fa-fw fa-times close'></i></a></div></div>",steps:[{content:"Note that this platform is currently under active development but all the basic functions are available and can be used to save markers and images. Please see the repository on github for current bugs",duration:16e3,orphan:true}]});var mobileTour=new Tour({name:"mobile-tour",template:"<div class='popover tour'><div class='arrow'></div><div class='popover-content'></div><div class='popover-navigation'><a class='btn-tour' data-role='end'><i class='fa fa-fw fa-times close'></i></a></div></div>",steps:[{element:".swipe-area-right",placement:"left",content:"Access the main menu by swiping from the right border of the screen.",duration:4e3}]});window.startTour=function(){if($(window).width()>=768){if(!localStorage.getItem("token")){devTour.init();devTour.start(true)}}if($(window).width()<768){mobileTour.init();mobileTour.start(true)}};$(document).ready(function(){setTimeout(startTour,1e3)});
var drawing=function(){var drawControl=new L.Control.Draw({position:"topright",draw:{circle:false,rectangle:false,marker:false}}),activate=function(){maps.map.addControl(drawing.drawControl);maps.map.on("draw:drawstart",function(e){var type=e.layerType,layer=e.layer;$(".btn-draw").addClass("disabled")});maps.map.on("draw:editstart",function(e){maps.map.off("click",actions.mapClick);$(".btn-draw").addClass("disabled")});maps.map.on("draw:editstop",function(e){$(".leaflet-draw-edit-edit").removeClass("visible");$(".leaflet-draw-edit-remove").removeClass("visible")});maps.map.on("draw:deletestart",function(e){maps.map.off("click",actions.mapClick);$(".btn-draw").addClass("disabled")});maps.map.on("draw:deletestop",function(e){maps.map.on("click",actions.mapClick);$(".leaflet-draw-edit-edit").removeClass("visible");$(".leaflet-draw-edit-remove").removeClass("visible")});maps.map.on("draw:drawstop",function(){maps.map.off("click",actions.mapClick);maps.map.on("click",actions.mapClick)});maps.map.on("draw:created",function(e){var latlngs=e.layer.getLatLngs().toString().replace(/\(/g,"[").replace(/\)/g,"]").replace(/LatLng/g,""),polylinelayer;if(e.layerType==="polyline"){if($(window).width()<=567){ui.sidebar.show($("#create-litter-dialog").show())}polylineLayer=e.layer;maps.map.fitBounds(e.layer.getBounds(),{paddingBottomRight:[300,0]});$(".litter-latlngs").val(latlngs);$("input[type=radio]").on("change",function(){var selectedValue=parseInt($(this).attr("name"),10);e.layer.setStyle({color:tools.setPolylineColor(selectedValue)})});maps.map.addLayer(e.layer);$(".btn-cancel").on("click",function(){$(".leaflet-draw-edit-edit").removeClass("visible");$(".leaflet-draw-edit-remove").removeClass("visible");maps.map.removeLayer(e.layer)});ui.sidebar.on("hide",function(){maps.map.removeLayer(e.layer)})}if(e.layerType==="polygon"){if($(window).width()<=567){ui.sidebar.show($("#create-area-dialog").show())}polygonLayer=e.layer;maps.map.fitBounds(e.layer.getBounds(),{paddingBottomRight:[300,0]});$(".form-area .area-latlngs").val(latlngs);maps.map.addLayer(e.layer);$(".btn-cancel").on("click",function(){$(".leaflet-draw-edit-edit").removeClass("visible");$(".leaflet-draw-edit-remove").removeClass("visible");maps.map.removeLayer(e.layer)});ui.sidebar.on("hide",function(){maps.map.removeLayer(e.layer)})}maps.map.on("click",actions.mapClick)});maps.map.on("draw:edited",function(e){var layers=e.layers;layers.eachLayer(function(layer){var type=e.layerType,currentlayer=e.layer;if(type==="polyline"){return"polyline"}if(type==="polygon"){return"polygon"}});maps.map.on("click",actions.mapClick())});$(".btn-draw-polyline").on("click",function(){maps.map.off("click",actions.mapClick);$(".leaflet-draw-edit-remove").addClass("visible");new L.Draw.Polyline(maps.map,{allowIntersection:false,drawError:{color:"#cc0000",timeout:2e3},metric:true,clickable:true,shapeOptions:{color:"#A9A9A9",weight:10,opacity:.5}}).enable();if($(window).width()<=567){ui.sidebar.hide();showAlert(14,"warning",3500)}});$(".btn-draw-polygon").on("click",function(){maps.map.off("click",actions.mapClick);$(".leaflet-draw-edit-remove").addClass("visible");new L.Draw.Polygon(maps.map,{shapeOptions:{color:"#33cccc",weight:5,opacity:.5},showArea:true,metric:true,clickable:true,allowIntersection:false,drawError:{color:"#cc0000",timeout:2e3}}).enable();if($(window).width()<=567){ui.sidebar.hide();showAlert(14,"warning",3500)}})};return{init:activate,drawControl:drawControl}}();drawing.init();
var social=function(){var network=[{iconclass:"fa-facebook",btnclass:"btn-facebook",title:"Share on Facebook",targeturl:""},{iconclass:"fa-twitter",btnclass:"btn-twitter",title:"Share on Twitter",targeturl:""},{iconclass:"fa-google-plus",btnclass:"btn-google-plus",title:"Share on Google+",targeturl:""},{iconclass:"fa-reddit fa-lg fa-icon-centered",btnclass:"btn-reddit",title:"Share on Reddit",targeturl:""},{iconclass:"fa-tumblr",btnclass:"btn-tumblr",title:"Share on Tumblr",targeturl:""},{iconclass:"fa-vk fa-icon-centered",btnclass:"btn-vk",title:"Share on V-Kontakti",targeturl:""},{iconclass:"fa-whatsapp fa-lg fa-icon-centered",btnclass:"btn-whatsapp",title:"Share on Whatsapp",targeturl:""},{iconclass:"fa-renren fa-lg fa-icon-centered",btnclass:"btn-renren",title:"Share on RenRen",targeturl:""}],shareThisFeature=function(obj){var encoded_url=encodeURIComponent(window.location),feature_image_url,feature_note,feature_tags;obj.image_url?feature_image_url=obj.image_url:feature_image_url="";feature_image_url_encoded=encodeURIComponent(feature_image_url);obj.note?feature_note=obj.note:feature_note="";feature_note_encoded=encodeURIComponent(feature_note);obj.tags?feature_tags=obj.tags:feature_tags="";feature_tags_encoded=encodeURIComponent(feature_tags);network[0].targeturl="https://www.facebook.com/dialog/feed?app_id=109950712685962&display=page&href="+encoded_url+"&description="+feature_note_encoded+"&link="+encoded_url+"&picture="+feature_image_url_encoded+"&name=Garbagepla.net&redirect_uri=https://www.garbagepla.net";network[1].targeturl="https://twitter.com/intent/tweet?text=Shared%20from%20www.garbagepla.net%20"+feature_note_encoded+"%20"+feature_tags_encoded+"%20"+encoded_url;network[2].targeturl="https://plus.google.com/share?url="+encoded_url;network[3].targeturl="http://reddit.com/submit?url="+encoded_url+"&title=Shared%20from%20www.garbagepla.net";network[4].targeturl="http://www.tumblr.com/share/link?url="+encoded_url+"&amp;name="+"&amp;description="+feature_note_encoded;network[5].targeturl="https://vk.com/share.php?url="+encoded_url;network[6].targeturl="whatsapp://send?text=Shared%20from%20www.garbagepla.net";network[7].targeturl="http://share.renren.com/share/buttonshare.do?link="+encoded_url+"&title=Share from Garbagepla.net"},game=function(){var getPlayers=function(e){if(!localStorage.getItem("token")){alerts.showAlert(3,"info",2e3)}else{setTimeout(function(){var useToken=localStorage.getItem("token")||window.token,title=e;$.ajax({method:"GET",url:api.getPlayersList.url(id),headers:{Authorization:"Bearer"+useToken},success:function(response){},error:function(err){}})},100)}},printGameData=function(){void 0};return{getPlayers:getPlayers,printGameData:printGameData}};return{network:network,shareThisFeature:shareThisFeature,game:game}}();